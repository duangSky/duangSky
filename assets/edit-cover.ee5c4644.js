var b=(p,A,m)=>new Promise((d,C)=>{var h=a=>{try{c(m.next(a))}catch(r){C(r)}},i=a=>{try{c(m.throw(a))}catch(r){C(r)}},c=a=>a.done?d(a.value):Promise.resolve(a.value).then(h,i);c((m=m.apply(p,A)).next())});import{d as Z,r as u,j as n,v as ee,o as R,b as W,w as t,k as o,n as I,A as F,J as D,a as s,l as ae,cn as le,_ as oe,a4 as ue,E as B,p as te,f as se}from"./index.5a90395c.js";import{u as ne}from"./creative.ea528d59.js";import{a as de}from"./base64Conver.96a5c530.js";const U=p=>(te("data-v-f3147c98"),p=p(),se(),p),ce={class:"cover"},ie=["src"],re={class:"block"},_e=U(()=>s("div",{class:"el-upload__text"},[I("\u5C06\u6587\u4EF6\u62D6\u5230\u6B64\u5904\uFF0C\u6216"),s("em",null,"\u70B9\u51FB\u4E0A\u4F20")],-1)),ve={class:"uploadImg"},pe={class:"img mask"},me=["src"],fe={class:"tip"},ge=U(()=>s("span",null,"\u6CE8\u610F\uFF1A",-1)),Ce=U(()=>s("span",null,"\u5C01\u9762\u56FE\u4E0D\u80FD\u542B\u6709\u7248\u6743\u6C34\u5370\u6216\u660E\u663E\u7684\u63A8\u5E7F\u4FE1\u606F\uFF0C\u5426\u5219\u5C06\u5F71\u54CD\u5BA1\u6838\u53CA\u63A8\u5E7F\u7ED3\u679C",-1)),he=Z({__name:"edit-cover",emits:["replaceCoverImg"],setup(p,{expose:A,emit:m}){const d=u(!1),C=u(""),h=u(""),i=u(!1),c=u("cut"),a=u(),r=u(0),V=u(0),k=u(0),E=u(0),w=u({}),_=u(""),S=m,T=()=>b(this,null,function*(){yield ue(),E.value=a.value.duration,r.value=a.value.offsetWidth*3,V.value=a.value.offsetHeight*3,E.value||setTimeout(()=>{T()},1e3)}),N=()=>{k.value=0,w.value={},_.value=""},H=l=>{a.value.currentTime=l},L=l=>b(this,null,function*(){i.value=!0;let{code:e,data:v,msg:f}=yield ne({base64Content:l,group:"",base64Path:"uploads"});e==201?(B.success("\u622A\u53D6\u6210\u529F"),S("replaceCoverImg",{id:h.value,url:v.media_url}),d.value=!1):B.error(f),i.value=!1}),M=()=>{const l=document.createElement("canvas");l.width=r.value,l.height=V.value;let e=l.getContext("2d");e==null||e.drawImage(a.value,0,0,r.value,V.value);let v=l.toDataURL("image/png");L(v)},O=l=>b(this,null,function*(){let e=yield de(l);w.value={base64Content:e,group:"",base64Path:"uploads"},i.value=!0}),P=l=>{let{code:e,data:v,msg:f}=l;e==201?(B.success("\u4E0A\u4F20\u6210\u529F"),_.value=v.media_url):B.error(f),i.value=!1},j=()=>{_.value=""},J=()=>{S("replaceCoverImg",{id:h.value,url:_.value}),d.value=!1},$=()=>{N()};return A({dialogVisible:d,videoUrl:C,videoId:h}),(l,e)=>{const v=n("el-slider"),f=n("el-tab-pane"),q=n("upload-filled"),x=n("el-icon"),z=n("el-upload"),G=n("Delete"),K=n("el-tabs"),Q=n("Warning"),y=n("el-button"),X=n("el-dialog"),Y=ee("loading");return R(),W(X,{modelValue:d.value,"onUpdate:modelValue":e[3]||(e[3]=g=>d.value=g),title:"\u8BBE\u7F6E\u5C01\u9762",width:"660",onOpen:T,onClose:$},{footer:t(()=>[o(y,{onClick:e[2]||(e[2]=g=>d.value=!1)},{default:t(()=>[I("\u53D6\u6D88")]),_:1}),F(o(y,{type:"primary",onClick:M},{default:t(()=>[I("\u786E \u5B9A")]),_:1},512),[[D,c.value=="cut"]]),F(o(y,{type:"primary",onClick:J},{default:t(()=>[I("\u786E \u5B9A")]),_:1},512),[[D,c.value=="upload"]])]),default:t(()=>[F((R(),W(K,{modelValue:c.value,"onUpdate:modelValue":e[1]||(e[1]=g=>c.value=g),onTabChange:N},{default:t(()=>[o(f,{label:"\u622A\u53D6\u5C01\u9762",name:"cut"},{default:t(()=>[s("div",ce,[s("video",{ref_key:"videoRef",ref:a,src:C.value,crossorigin:"anonymous"},null,8,ie)]),s("div",re,[o(v,{modelValue:k.value,"onUpdate:modelValue":e[0]||(e[0]=g=>k.value=g),step:.01,max:E.value,disabled:!E.value,onInput:H},null,8,["modelValue","max","disabled"])])]),_:1}),o(f,{label:"\u4E0A\u4F20\u5C01\u9762",name:"upload"},{default:t(()=>[F(o(z,{drag:"",data:w.value,"show-file-list":!1,action:ae(le),"before-upload":O,"on-success":P},{default:t(()=>[o(x,{class:"el-icon--upload"},{default:t(()=>[o(q)]),_:1}),_e]),_:1},8,["data","action"]),[[D,!_.value]]),F(s("div",ve,[s("div",pe,[s("img",{src:_.value,alt:""},null,8,me),o(x,{class:"delIcon",onClick:j},{default:t(()=>[o(G)]),_:1})])],512),[[D,_.value]])]),_:1})]),_:1},8,["modelValue"])),[[Y,i.value,void 0,{fullscreen:!0,lock:!0}]]),s("div",fe,[o(x,null,{default:t(()=>[o(Q)]),_:1}),ge,Ce])]),_:1},8,["modelValue"])}}}),Be=oe(he,[["__scopeId","data-v-f3147c98"]]);export{Be as default};
