var z=(d,w,p)=>new Promise((y,m)=>{var S=i=>{try{_(p.next(i))}catch(f){m(f)}},e=i=>{try{_(p.throw(i))}catch(f){m(f)}},_=i=>i.done?y(i.value):Promise.resolve(i.value).then(S,e);_((p=p.apply(d,w)).next())});import{d as G,a0 as N,r as b,T as J,j as C,o as g,b as E,w as M,l as v,a as u,t as T,k as c,c as $,y as K,q as Q,F as U,_ as W,E as k,p as X,f as Y}from"./index.5a90395c.js";import{u as ee}from"./material.85a80f57.js";import{u as ae}from"./imgText.df790733.js";import{I as te}from"./ImportMeterial.9b103172.js";import{d as R}from"./index.0e306189.js";import H from"./material-card.f7d63667.js";import{t as le}from"./index.2523f7b1.js";import{a as oe}from"./creative.ea528d59.js";import"./keyword.011c6f30.js";import"./index.browser.2b0920b0.js";import"./AliCloudUpload.13488d40.js";import"./Pagination.554cb32d.js";import"./audio.531569af.js";import"./MediumPreview.37c6af48.js";const A=d=>(X("data-v-f99a07ae"),d=d(),Y(),d),se={class:"selectMaterial"},ue={class:"top"},re={class:"choose"},ie=A(()=>u("span",null,"\u9009\u62E9\u7D20\u6750",-1)),ne=A(()=>u("span",null,"\u667A\u80FD\u5339\u914D",-1)),ce=[ne],de={class:"scene"},pe={class:"top"},me={class:"choose"},_e=["onClick"],fe=A(()=>u("span",null,"\u6DFB\u52A0\u7D20\u6750",-1)),he=["onClick"],ve=A(()=>u("span",null,"\u5220\u9664\u573A\u666F",-1)),De=[ve],Fe=G({__name:"work-material",setup(d,{expose:w}){const p=ee(),y=ae(),{selectMaterals:m,screen:S}=N(p),{form:e,makeData:_}=N(y),i=b(),f=b(),h=b(0),V=l=>{e.value.data.Scene.splice(l,1),e.value.data.AppointNum=e.value.data.Scene.length},Z=l=>{h.value=l,m.value=e.value.data.Scene[l-1],B()},q=()=>{m.value=e.value.data.Material,B()},B=()=>{S.value.type="image",S.value.uploadedData=["image"],f.value.drawer=!0},I=(l,o)=>{o?e.value.data.Scene[o-1]=e.value.data.Scene[o-1].filter(t=>t.id!==l.id):e.value.data.Material=e.value.data.Material.filter(t=>t.id!==l.id)},x=l=>{if(!l)return;let o=[...e.value.data.Material,...m.value],t={};h.value?(e.value.data.Scene[h.value-1]=o.reduce((a,s)=>(t[s.id]||(t[s.id]=a.push(s)),a),[]).map(a=>R(a)),k.success("\u7D20\u6750\u5BFC\u5165\u6210\u529F")):(e.value.data.Material=o.reduce((a,s)=>(t[s.id]||(t[s.id]=a.push(s)),a),[]).map(a=>R(a)),j()),h.value=0},L=()=>z(this,null,function*(){console.log("\u667A\u80FD\u5339\u914D",_.value.zhuci);let l=e.value.data.Zhuci.length?e.value.data.Zhuci:_.value.zhuci.map(D=>D.name),o={filter:{type:["image"],tags_zhuci:l},op:{type:"in",tags_zhuci:"in"},page:1,limit:1e3},{code:t,data:a,msg:s}=yield oe(o);if(t==200){let D=[...e.value.data.Material,...a.list],F={};e.value.data.Material=D.reduce((r,n)=>(F[n.id]||(F[n.id]=r.push(n)),r),[]).map(r=>R(r)),a.list.length?j():k.warning("\u5339\u914D\u7ED3\u679C\u4E3A\u7A7A")}else k.error(s)}),j=()=>{if(e.value.data.Material.length>1e3){e.value.data.Material=e.value.data.Material.slice(0,1e3),k.warning("\u7D20\u6750\u6570\u91CF\u8D85\u51FA\u6700\u5927\u503C\u9650\u5236\uFF0C\u8D85\u51FA\u90E8\u5206\u5DF2\u81EA\u52A8\u622A\u53D6");return}k.success("\u7D20\u6750\u5BFC\u5165\u6210\u529F")},O=()=>new Promise((l,o)=>{i.value.validate((t,a)=>{t?l("submit"):o(a)})}),P=J(()=>{let l={},o=[];return e.value.data.Scene.forEach((t,a)=>{h.value&&a!==h.value-1&&t.forEach(s=>o.push(s))}),o=o.reduce((t,a)=>(l[a.id]||(l[a.id]=t.push(a)),t),[]),o});return w({proof:O}),(l,o)=>{const t=C("DArrowRight"),a=C("el-icon"),s=C("el-form-item"),D=C("el-form");return g(),E(D,{class:"inForm",ref_key:"formRef",ref:i,model:v(e),rules:v(le),"label-width":"72"},{default:M(()=>[v(e).data.MaterialConfig===1?(g(),E(s,{key:0,label:"\u5DF2\u9009\u7D20\u6750",prop:"data.Material"},{default:M(()=>[u("div",se,[u("div",ue,[u("span",re,"\u5DF2\u9009\uFF1A"+T(v(e).data.Material.length),1),u("div",{class:"pick",onClick:q},[ie,c(a,null,{default:M(()=>[c(t)]),_:1})]),u("div",{class:"pick",onClick:L},ce)]),c(H,{materials:v(e).data.Material,onHandleDelete:I},null,8,["materials"])])]),_:1})):(g(!0),$(U,{key:1},K(v(e).data.Scene,(F,r)=>(g(),E(s,{label:`\u573A\u666F${r+1}`,key:r,prop:`data.Scene[${r}]`,class:"formScene"},{default:M(()=>[u("div",de,[u("div",pe,[u("span",me,"\u5DF2\u9009\uFF1A"+T(F.length),1),u("div",{class:"pick",onClick:n=>Z(r+1)},[fe,c(a,null,{default:M(()=>[c(t)]),_:1})],8,_e),r?(g(),$("div",{key:0,class:"pick",onClick:n=>V(r)},De,8,he)):Q("",!0)]),c(H,{materials:F,onHandleDelete:n=>I(n,r+1)},null,8,["materials","onHandleDelete"])])]),_:2},1032,["label","prop"]))),128)),c(te,{ref_key:"meterialRef",ref:f,allScript:P.value,onCloseDrawer:x},null,8,["allScript"])]),_:1},8,["model","rules"])}}}),Ne=W(Fe,[["__scopeId","data-v-f99a07ae"]]);export{Ne as default};
